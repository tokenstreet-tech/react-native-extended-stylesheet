name: 🚀 Continuous deployment
on:
    workflow_dispatch:
        inputs:
            version:
                description: "Version ['patch', 'minor', 'major']"
                required: true

jobs:
    publish_package:
        name: ⬆️ Publish package
        runs-on: ubuntu-latest
        steps:
            - name: 🛑 Cancel Previous Runs
              uses: styfle/cancel-workflow-action@0.11.0
            - name: ⬇️ Checkout repo
              uses: actions/checkout@v3
              with:
                  token: ${{ secrets.PERSONAL_ACCESS_TOKEN_TOOLS_TOKENSTREET }}
            - name: Set git credentials
              run: |
                  git config --global user.name "tokenstreet Tools"
                  git config --global user.email "tools@tokenstreet.com"
            - name: ⎔ Setup node
              uses: actions/setup-node@v3
              with:
                  node-version: 18
                  registry-url: 'https://registry.npmjs.org'
            - name: 📥 Download deps
              uses: bahmutov/npm-install@v1
            - run: yarn version --${{ github.event.inputs.version }}
              working-directory: ./packages/core
            - run: git push --follow-tags
            - run: yarn publish
              working-directory: ./packages/core
              env:
                  NODE_AUTH_TOKEN: ${{ secrets.NPM_AUTH_TOKEN }}
